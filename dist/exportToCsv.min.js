
(function(root,factory){if(typeof module==="object"&&module.exports){module.exports=factory(require('lodash'));}else if(typeof define==="function"&&define.amd){define(["lodash"],factory);}else{root.exportToCsv=factory(root._);}}(this,function(_){var options={};var buildDOMHeaderRow=function($theads,csv){var headers=_.map($theads,function(el){return el.innerHTML;});headers.push(options.rowDelim);csv.push(headers.join(options.colDelim));};var buildDOMBody=function($trs,csv){var rows=_.map($trs,function($tr){var thing=_.map($tr.children,function($td){return $td.innerHTML;});thing.push(options.rowDelim);return thing.join(options.colDelim);});return csv.concat(rows);};var buildArrayHeaderRow=function(input,csv){var header=_.keys(input[0]);header.push(options.rowDelim);csv.push(header.join(options.colDelim));};var buildArrayBody=function(input,csv){var output=_.map(input,function(item){var values=_.values(item);values.push(options.rowDelim);return values.join(options.colDelim);});return csv.concat(output);};var exportToCsv=function(selector,userOpts){var defaultOptions={colDelim:',',rowDelim:'\r\n',headerRow:true,fileName:'data.csv',autoDownload:true};var csv=[];var a=document.createElement('a');var $table,$theads,$bodyRows;var blob,url;if(!_){throw new Error('Must have _');}
options=_.defaults(userOpts||{},defaultOptions);if(_.isArray(selector)&&selector.length>0){if(options.headerRow){buildArrayHeaderRow(selector,csv);}
csv=buildArrayBody(selector,csv);}else if(_.isString(selector)){$table=document.querySelectorAll(selector);$theads=document.querySelectorAll(selector+' thead th');$bodyRows=document.querySelectorAll(selector+' tbody tr');if($table.length===0){throw new Error('Table not found with the selector "'+selector+'"');}
if(options.headerRow){buildDOMHeaderRow($theads,csv);}
csv=buildDOMBody($bodyRows,csv);}else{throw new Error('argument[0] must be either a string or an array');}
a.style='display: none';this.download=function(){document.body.appendChild(a);blob=new Blob(csv,{type:'octet/stream'});url=window.URL.createObjectURL(blob);a.href=url;a.download=options.fileName;a.click();window.URL.revokeObjectURL(url);document.body.removeChild(a);};this._buildArrayHeaderRow=buildArrayHeaderRow;this._buildArrayBody=buildArrayBody;this._buildDOMHeaderRow=buildDOMHeaderRow;this._buildDOMBody=buildDOMBody;if(options.autoDownload){this.download();}}
return exportToCsv;}));